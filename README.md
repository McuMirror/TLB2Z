# TLB2Z
BLE Repeater in Zigbee on TLRS825x

# Ретранслятор до 3-х BLE термометров в Zigbee v3 на модуле с чипом TLSR825x.

Используется модуль TB-03F-KIT или TB-04-KIT

* Программа для настройки BLE [BLE2Zigbee.html](https://pvvx.github.io/TLB2Z/BLE2Zigbee.html)
* [Начальное программирование модуля](https://github.com/pvvx/TLB2Z/tree/master/pgm)
* [Файлы прошивки и Zigbee OTA](https://github.com/pvvx/TLB2Z/tree/master/fw)

## Основные технические характеристики

* Прием BLE рекламы до 3-х термометров-гигрометров и перевод показаний в виде конечного устройства Zigbee.
* Zigbee устройство использует 3 endpoint для каждого BLE термометра-гигрометра.
* Zigbee TX +10 дБм, BLE TX +0 дБм (BLE используется только для настройки).
* Поддержка Zigbee OTA.
* Поддержка рекламных BLE форматов Xiaomi, Qingping, BTHome v2, Custom.
* Поддержка зашифрованной рекламы BLE с помощью bindkey.
* Среднее потребление при работе модуля TB-03F-KIT от USB (5V): 10.07 мА

## Настройка модуля

1.	Подключите запрограммированный модуль к питанию
2.	Загрузите [BLE2Zigbee.html](https://pvvx.github.io/TLB2Z/BLE2Zigbee.html)
3.	На 1 секунду нажмите кнопку с надписью “PROG”. Это действие переключит модуль на работу в режим ожидания поджключения по BLE. Время ожидания подключения - 80 секунд.
4.	В [BLE2Zigbee.html](https://pvvx.github.io/TLB2Z/BLE2Zigbee.html) произведите подключение к BLE устройству “B2Z-xxxxxx”.
5.	Введите MAC термометров и по необходимости используемые BindKey.
6.	Проследите, что данные принимаются:

![b2z_html.gif](https://github.com/pvvx/TLB2Z/blob/master/web/b2z_html.gif)

7.	Закройте [BLE2Zigbee.html](https://pvvx.github.io/TLB2Z/BLE2Zigbee.html).

## Сопряжение модуля с Zigbee

1.	Включите режим сопряжения на Zigbee координаторе или роутере
2.	Нажмите кнопку и удерживайте 8 секунд кнопку на модуле с надписью “PROG”. Это действие сбросит привязки и настройки Zigbee.
3.	Проследите сопряжение кластеров температуры, влажности и батареи. Установите желаемые значения для “Report”.

![b2z_zha.gif](https://github.com/pvvx/TLB2Z/blob/master/web/b2z_zha.gif)

## LED индикация

### Светодиод RGB коротко мигает при приеме данных от BLE устройств.

* Красный цвет светодиода – прием от 1-го термометра
* Зеленый цвет светодиода – прием от 2-го термометра
* Синий цвет светодиода – прием от 3-го термометра

### Белый светодиод отображает состояние Zigbee. 

* Светится постоянно, если сопряжения нет
* Мигает 7 раз при сопряжении
* Мигает по команде “Identify”

### Желтый светодиод отображает состояние BLE. 

* Коротко мигает при ожидании BLE подключения
